generator client {
  provider   = "prisma-client"
  output     = "./generated/prisma"
  engineType = "client"
  runtime    = "bun"
}

datasource db {
  provider = "mysql"
}

model User {
  id           Int         @id @default(autoincrement())
  userName     String      @unique
  email        String      @unique
  password     String
  sessionID    String      @unique
  Deck         Deck[]
  time_created DateTime    @default(now())
  time_updated DateTime    @default(now()) @updatedAt
  GameState    GameState   @default(IDLE)
  Characters   Character[]
}

enum GameState {
  IDLE
  IN_BATTLE
  SEARCHING
}

model Deck {
  id           Int        @id @default(autoincrement())
  name         String
  userId       Int
  description  String
  time_created DateTime   @default(now())
  time_updated DateTime   @updatedAt
  user         User       @relation(fields: [userId], references: [id])
  deckCards    DeckCard[]
}

// Join table - links decks to cards with quantity
model DeckCard {
  id       Int @id @default(autoincrement())
  deckId   Int
  cardId   Int
  quantity Int @default(1)

  deck Deck     @relation(fields: [deckId], references: [id], onDelete: Cascade)
  card CardData @relation(fields: [cardId], references: [id])

  @@unique([deckId, cardId])
}

// Card definitions (master library)
model CardData {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  type        CardType
  description String
  siege       Int
  bastion     Int
  spirit_cost Int
  health      Int

  time_created DateTime   @default(now())
  time_updated DateTime   @updatedAt
  deckCards    DeckCard[]
}

model Battle {
  id           Int         @id @default(autoincrement())
  players      Character[]
  current_turn Int

  time_created DateTime @default(now())
  time_updated DateTime @updatedAt
}

model Character {
  id           Int      @id @default(autoincrement())
  name         String
  health       Int
  max_health   Int
  time_created DateTime @default(now())
  time_updated DateTime @updatedAt
  User         User?    @relation(fields: [userId], references: [id])
  userId       Int?
  Battle       Battle?  @relation(fields: [battleId], references: [id])
  battleId     Int?
}

enum CardType {
  CREATURE
  SPELL
  AREA
}
